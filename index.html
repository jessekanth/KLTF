<!DOCTYPE html>
<html lang="en">
<head>
  <title>Church Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Previous CSS remains the same until monthly table styles */

    /* Updated Monthly Table Styles */
    .monthly-table-container {
      margin: 15px;
      background: var(--white);
      border-radius: 5px;
      padding: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      overflow-x: auto;
    }

    .monthly-table {
      width: 100%;
      border-collapse: collapse;
    }

    .monthly-table th {
      background-color: var(--deep-blue);
      color: var(--white);
      padding: 10px 12px;
      text-align: left;
    }

    .monthly-table td {
      padding: 8px 12px;
      border-bottom: 1px solid #eee;
    }

    .monthly-table tr.month-total-row {
      background-color: var(--light-blue);
      color: var(--white);
      font-weight: bold;
    }

    .monthly-table .amount-column {
      text-align: right;
      min-width: 100px;
    }

    /* Print Styles */
    @media print {
      .monthly-table-container {
        page-break-inside: avoid;
      }
      
      .monthly-table tr.month-total-row {
        background-color: var(--light-blue) !important;
        color: var(--white) !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
    }
  </style>
</head>
<body>
  <!-- Previous HTML remains the same until the monthlyView section -->

  <div id="monthlyView">
    <div class="monthly-table-container">
      <h3 style="margin-top:0;color:var(--deep-blue)">Monthly Donations</h3>
      <table class="monthly-table" id="monthlyDonationsTable">
        <thead>
          <tr>
            <th>Month</th>
            <th>Donation Type</th>
            <th class="amount-column">Amount (RM)</th>
          </tr>
        </thead>
        <tbody>
          <!-- Data will be inserted here -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Rest of the HTML remains the same -->

  <script>
    // Previous JavaScript remains the same until the updateMonthlyView function

    // Update monthly view with simplified table
    function updateMonthlyView(donations) {
      const monthlyData = {};
      
      // Organize data by month
      donations.forEach(d => {
        if (isNaN(d.date.getTime())) return;
        
        const monthYear = `${d.date.getFullYear()}-${(d.date.getMonth()+1).toString().padStart(2, '0')}`;
        const monthName = d.date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
        
        if (!monthlyData[monthYear]) {
          monthlyData[monthYear] = {
            name: monthName,
            types: {},
            total: 0,
            timestamp: d.date.getTime()
          };
        }
        
        if (!monthlyData[monthYear].types[d.type]) {
          monthlyData[monthYear].types[d.type] = 0;
        }
        
        monthlyData[monthYear].types[d.type] += d.amount;
        monthlyData[monthYear].total += d.amount;
      });
      
      const monthlyContainer = document.getElementById('monthlyDonationsTable').querySelector('tbody');
      monthlyContainer.innerHTML = '';
      
      const sortedMonths = Object.entries(monthlyData)
        .sort((a, b) => b[1].timestamp - a[1].timestamp);
      
      if (sortedMonths.length === 0) {
        monthlyContainer.innerHTML = '<tr><td colspan="3">No data available for selected period</td></tr>';
        return;
      }
      
      // Create table rows for each month
      sortedMonths.forEach(([key, month]) => {
        // Add month total row
        const monthTotalRow = document.createElement('tr');
        monthTotalRow.className = 'month-total-row';
        monthTotalRow.innerHTML = `
          <td>${month.name}</td>
          <td>Total</td>
          <td class="amount-column">${month.total.toFixed(2)}</td>
        `;
        monthlyContainer.appendChild(monthTotalRow);
        
        // Add rows for each donation type (sorted alphabetically by type)
        const sortedTypes = Object.entries(month.types)
          .sort((a, b) => a[0].localeCompare(b[0])); // Sort alphabetically by type
        
        sortedTypes.forEach(([type, amount]) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td></td>
            <td>${type}</td>
            <td class="amount-column">${amount.toFixed(2)}</td>
          `;
          monthlyContainer.appendChild(row);
        });
      });
    }

    // Rest of the JavaScript remains the same
  </script>
</body>
</html>
